<div class="max-w-4xl mx-auto px-4 py-4 bg-white shadow-lg rounded-lg">
  <form (ngSubmit)="onSubmitMusic()">
    <div class="flex flex-row justify-between">
      <div class="flex justify-center self-center">
        <input hidden (change)="onFileChange($event)" #fileInput type="file" />
        <button mat-raised-button type="button" (click)="fileInput.click()" class="self-center">
          Choose Music
        </button>
        <div class="ms-2 text-sm font-medium text-gray-700 self-center">{{ musicFile?.name }}</div>
      </div>
      <div class="flex justify-center self-center">
        <button mat-button type="submit" [disabled]="!musicBase64">
          <mat-icon>cloud_upload</mat-icon>
          Upload
        </button>
      </div>
    </div>
  </form>
</div>

<div class="max-w-4xl mx-auto px-4 py-2 bg-white shadow-lg rounded-lg mt-4">
  <audio
    #audioPlayerRef
    src="currentMusic?.music.presignedUrl"
    (loadedmetadata)="onLoadedMetadata()"
    (timeupdate)="onTimeUpdate()"
  >
    <source [src]="currentMusic.music.presignedUrl" type="audio/mpeg" />
    Your browser does not support the audio element.
  </audio>
  <div class="flex flex-col w-full">
    <div class="flex">
      <label for="timeRange" class="mr-2 text-sm font-medium text-gray-700 self-center">
        {{ currentMusic.currentTime * 1000 | date: 'm:ss' }}/{{
          currentMusic.duration * 1000 | date: 'm:ss'
        }}
      </label>
      <mat-slider
        min="0"
        [max]="currentMusic.duration"
        value-indicator-width="0"
        style="width: 100%"
      >
        <input
          matSliderThumb
          [(ngModel)]="currentMusic.currentTime"
          (input)="onInputTimeChange($event)"
        />
      </mat-slider>
    </div>
    <div class="flex flex-wrap justify-between">
      <div class="flex" style="height: 44px">
        <button
          mat-mini-fab
          (click)="togglePlay()"
          [disabled]="!currentMusic.music.presignedUrl"
          class="self-center"
          style="height: 32px"
        >
          <mat-icon *ngIf="currentMusic.isPlaying">pause</mat-icon>
          <mat-icon *ngIf="!currentMusic.isPlaying">play_arrow</mat-icon>
        </button>
      </div>
      <div class="flex" style="height: 44px">
        <div class="self-center">
          <span class="text-sm text-nowrap font-medium text-gray-700">
            {{ currentMusic.music.title }}
          </span>
        </div>
      </div>
      <div>
        <label
          for="volumeRange"
          class="mr-2 text-sm text-nowrap font-medium text-gray-700 self-center"
        >
          Volume: {{ currentMusic.volume * 100 | number: '1.0-0' }}%
        </label>
        <mat-slider min="0" max="1" step="0.01" value="0.2" value-indicator-width="0">
          <input
            matSliderThumb
            [(ngModel)]="currentMusic.volume"
            (input)="onInputVolumeChange($event)"
          />
        </mat-slider>
      </div>
    </div>
  </div>
</div>

<div *ngIf="isLoading" class="mt-4 flex justify-center">
  <mat-spinner></mat-spinner>
</div>

<div
  *ngIf="(musicList$ | async) && !isLoading"
  class="max-w-4xl mx-auto px-4 py-2 bg-white shadow-lg rounded-lg mt-4"
>
  <div
    *ngFor="let music of musicList"
    class="flex items-center p-2 bg-gray-100 rounded-lg mb-2 space-x-2"
  >
    <div class="flex px-2 py-1 text-gray-700 mr-auto">{{ music.title }}</div>
    <div
      (click)="onSetUserSettingsMusicId(music)"
      class="flex px-2 py-1 bg-gray-200 text-gray-700 rounded-lg hover:text-yellow-200 hover:bg-gray-400 transition"
      [ngClass]="{ 'bg-pink-400': music.musicId === userSettingsMusicId }"
    >
      <mat-icon> favorite </mat-icon>
    </div>
    <div
      (click)="onDeleteMusic(music)"
      class="flex px-2 py-1 bg-gray-200 text-gray-700 rounded-lg hover:text-amber-700 hover:bg-gray-400 transition"
    >
      <mat-icon>delete</mat-icon>
    </div>
    <div
      (click)="onPlayMusic(music)"
      class="flex px-2 py-1 bg-gray-200 text-gray-700 rounded-lg hover:text-green-700 hover:bg-gray-400 transition"
    >
      <mat-icon>play_arrow</mat-icon>
    </div>
  </div>
</div>
